<div style="color: rgb(127,23,0)">
  機動性時間為“專屬日曆”中“月設定管理”針對個別日期所做的“修改供位設定”調整。<br>
  預設值以當天日期命名，臨時設定的內容為絕對優先(大於下方訂位的常態設定)。
</div>

<div id="special_time">
  <% @special_conditions.each do |c| %>
    <div>
      <div class="dropdown">
        <input name="con_id" type="hidden" value="<%= c.id %>">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#"><%= c.name %><b class="caret pull-right"></b></a>
        <ul class="dropdown-menu" role="menu">
          <li><a data-id="<%= c.id %>" class="edit_condition">編輯</a></li>
          <li><a data-id="<%= c.id %>" class="destroy_condition">刪除</a></li>
        </ul>
      </div>
      &nbsp;
      <label class="radio inline">
        <input type="radio" name="con_status<%= c.id %>" value="t" <%= c.status == 't' ? 'checked="checked"' : '' %>>
        開啓
      </label>
      &nbsp;
      <label class="radio inline">
        <input type="radio" name="con_status<%= c.id %>" value="f" <%= c.status == 'f' ? 'checked="checked"' : '' %>>
        關閉
      </label>
    </div>
  <% end %>
</div>
<br><br>
<div class="btn btn-primary" style="font-size: 13px" id="new_condition">
  <i class="icon-plus icon-white"></i>
  新增一組可提供訂位的常態時間
</div>

<div style="color: rgb(127,23,0)">
  因特別時段 / 節慶設定的供位時間會與日常供位設定發生時間重疊，<br>
  請餐廳經營者設立優先順序(以滑鼠拖曳方式，最上面為首)。
</div>
常態設定：
<div id="period_set">
  <% @normal_conditions.each_with_index do |c, index|%>
    <div class="sortable" data-sort="<%= index %>">
      <div class="dropdown">
        <input name="con_id" type="hidden" value="<%= c.id %>">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#"><%= c.name %><b class="caret pull-right"></b></a>
        <ul class="dropdown-menu" role="menu">
          <li><a data-id="<%= c.id %>" class="edit_condition">編輯</a></li>
          <li><a data-id="<%= c.id %>" class="destroy_condition">刪除</a></li>
        </ul>
      </div>
      &nbsp;
      <label class="radio inline">
        <input type="radio" name="con_status<%= c.id %>" value="t" <%= c.status == 't' ? 'checked="checked"' : '' %>>
        開啓
      </label>
      &nbsp;
      <label class="radio inline">
        <input type="radio" name="con_status<%= c.id %>" value="f" <%= c.status == 'f' ? 'checked="checked"' : '' %>>
        關閉
      </label>
    </div>
  <% end %>
</div>
<br>
<table id="reserve_table">
    <tr>
      <td>最晚接受訂位期間</td>
      <td>
        <label class="radio inline">
          <input type="radio" name="reserve_type" value="0">開放預約到
        </label>

        <input class="input-small" type="text" id="reserve_hour" value="<%= @restaurant.available_hour %>">小時之前的時間&nbsp;
        <a class="ans" title="為確保訂位人數，建議餐廳設定最晚的訂位時間，爲該用餐時段前的幾個小時。">?</a>
        <br>

        <label class="radio inline"><input type="radio" name="reserve_type" value="1">開放預約到前一天</label>
        <select class="input-small" id="reserve_previous_hour" data-value="<%= @restaurant.available_date %>">
          <option value="1:00">1</option>
          <option value="2:00">2</option>
          <option value="3:00">3</option>
          <option value="4:00">4</option>
          <option value="5:00">5</option>
          <option value="6:00">6</option>
          <option value="7:00">7</option>
          <option value="8:00">8</option>
          <option value="9:00">9</option>
          <option value="10:00">10</option>
          <option value="11:00">11</option>
          <option value="12:00">12</option>
          <option value="13:00">13</option>
          <option value="14:00">14</option>
          <option value="15:00">15</option>
          <option value="16:00">16</option>
          <option value="17:00">17</option>
          <option value="18:00">18</option>
          <option value="19:00">19</option>
          <option value="20:00">20</option>
          <option value="21:00">21</option>
          <option value="22:00">22</option>
          <option value="23:00">23</option>
          <option value="24:00">24</option>
        </select>點
        &nbsp;
        <a class="ans" title="為確保訂位人數，建議餐廳接受最晚的訂位時間，爲前一日的幾點幾分。">?</a>
      </td>
    </tr>
</table>

<a href="#" id="period_save" class="btn btn-primary">確定修改</a>
<a href="#" id="period_reset" class="btn">取消</a>
<br><br>
因特別時段 / 節慶設定的供位時間會與日常供位時間發生重疊，<br>
請餐廳經營者設定時間的優先順序(以滑鼠拖曳方式，最上面為首)。<br><br>


<script>
    //===========================================================================
    // view: supply_condition
    //===========================================================================

    $(":radio[name='reserve_type'][value='<%= @restaurant.available_type %>']").attr("checked",'checked');

    $("#period_save").click(function(e){
        e.preventDefault()
        var ids = ''
        var status = ''

        $("#form_place [name='con_id']").each(function(){
            ids = ids + ',' + $(this).val();
        });

        $('#form_place input:radio:checked').each(function(){
            status = status + ',' + $(this).val();
        });

        var reserve_type = $("#reserve_table [name='reserve_type']:checked").val()
        var reserve_hour = $("#reserve_hour").val()
        var reserve_previous_hour = $("#reserve_previous_hour").val()
        var reserve_previous_type = $("#reserve_previous_type").val()

        var con_state = {
            id_list: ids,
            status_list: status,
            reserve_type: reserve_type,
            reserve_hour: reserve_hour,
            reserve_previous_hour: reserve_previous_hour,
            reserve_previous_type: reserve_previous_type
        }

        $.ajax({
            url: "/restaurant_manage/condition_state_save",
            type: 'POST',
            data:  JSON.stringify(con_state),
            cache: false,
            success: function(response){
                if (response.success)
                    alert(response.data)
                else if (response.error)
                    alert(response.message)
                else
                    alert('發生未預期的回應，請告知CoDream小組處理!')
            },
            error: function(){
                alert('oops! 出現錯誤了!');
            }
        });
    });

</script>